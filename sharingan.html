<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharingan Eye Tracker - Safari Compatible</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #e94560;
            text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #8fe3cf;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .sharingan-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(233, 69, 96, 0.4);
        }
        
        .sharingan-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23262626"/><path d="M0 0L100 100" stroke="%23333" stroke-width="1"/><path d="M100 0L0 100" stroke="%23333" stroke-width="1"/></svg>');
            opacity: 0.3;
        }
        
        .eyes-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 100px;
        }
        
        .eye {
            position: relative;
            width: 120px;
            height: 120px;
            background: #000;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }
        
        .pupil {
            position: absolute;
            width: 35px;
            height: 35px;
            background: #fff;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s ease-out;
        }
        
        .sharingan {
            position: absolute;
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
            transition: transform 0.2s ease-out;
        }
        
        .tomoe {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #e94560;
            border-radius: 50%;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .sharingan-btn {
            padding: 12px 20px;
            background: rgba(233, 69, 96, 0.3);
            color: #fff;
            border: 2px solid #e94560;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .sharingan-btn:hover {
            background: rgba(233, 69, 96, 0.5);
            transform: translateY(-2px);
        }
        
        .sharingan-btn.active {
            background: #e94560;
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.7);
        }
        
        .tracking-options {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .tracking-btn {
            padding: 10px 20px;
            background: rgba(143, 227, 207, 0.2);
            color: #8fe3cf;
            border: 2px solid #8fe3cf;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .tracking-btn:hover {
            background: rgba(143, 227, 207, 0.3);
        }
        
        .tracking-btn.active {
            background: rgba(143, 227, 207, 0.4);
            box-shadow: 0 0 10px rgba(143, 227, 207, 0.5);
        }
        
        .webcam-container {
            width: 100%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        #webcam {
            width: 100%;
            border-radius: 10px;
            display: none;
        }
        
        .status {
            margin-top: 15px;
            font-size: 1.1rem;
            color: #8fe3cf;
        }
        
        .instructions {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .instructions h2 {
            color: #e94560;
            margin-bottom: 15px;
        }
        
        .instructions ul {
            list-style-position: inside;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .safari-note {
            color: #ff9a76;
            margin-top: 15px;
            font-style: italic;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #8fe3cf;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .eyes-container {
                gap: 50px;
            }
            
            .eye {
                width: 80px;
                height: 80px;
            }
            
            .sharingan {
                width: 60%;
                height: 60%;
                top: 20%;
                left: 20%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sharingan Eye Tracker</h1>
            <p class="subtitle">Safari & MacBook Compatible Version</p>
        </header>
        
        <div class="main-content">
            <div class="controls">
                <button class="sharingan-btn active" data-type="one-tomoe">One Tomoe</button>
                <button class="sharingan-btn" data-type="two-tomoe">Two Tomoe</button>
                <button class="sharingan-btn" data-type="three-tomoe">Three Tomoe</button>
                <button class="sharingan-btn" data-type="mangekyo">Mangekyo</button>
            </div>
            
            <div class="tracking-options">
                <button class="tracking-btn active" data-type="mouse">Mouse Tracking</button>
                <button class="tracking-btn" data-type="camera">Camera Tracking</button>
            </div>
            
            <div class="sharingan-container">
                <div class="sharingan-background"></div>
                <div class="eyes-container">
                    <div class="eye">
                        <div class="pupil"></div>
                        <div class="sharingan" id="sharingan-left">
                            <!-- Tomoe will be added by JavaScript -->
                        </div>
                    </div>
                    <div class="eye">
                        <div class="pupil"></div>
                        <div class="sharingan" id="sharingan-right">
                            <!-- Tomoe will be added by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="webcam-container">
                <video id="webcam" autoplay playsinline></video>
                <div class="status" id="status">Select tracking mode above</div>
                <p class="safari-note">Note: Camera access requires HTTPS on Safari. For best results, use Mouse Tracking mode.</p>
            </div>
            
            <div class="instructions">
                <h2>How to Use:</h2>
                <ul>
                    <li>For camera tracking: Allow camera access when prompted</li>
                    <li>For mouse tracking: Move your mouse horizontally to control the eyes</li>
                    <li>Make sure you're in a well-lit area if using camera</li>
                    <li>Select different Sharingan types from the buttons above</li>
                    <li>Switch between mouse and camera tracking modes</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>This application uses your webcam for pose detection. No data is stored or sent to any server.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const statusElement = document.getElementById('status');
            const webcamElement = document.getElementById('webcam');
            const pupils = document.querySelectorAll('.pupil');
            const sharinganElements = document.querySelectorAll('.sharingan');
            const buttons = document.querySelectorAll('.sharingan-btn');
            const trackingButtons = document.querySelectorAll('.tracking-btn');
            
            // State
            let currentSharingan = 'one-tomoe';
            let isCameraActive = false;
            let currentTracking = 'mouse';
            
            // Initialize Sharingan
            function initSharingan() {
                updateSharingan(currentSharingan);
                
                // Set up button event listeners
                buttons.forEach(button => {
                    button.addEventListener('click', function() {
                        buttons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        currentSharingan = this.getAttribute('data-type');
                        updateSharingan(currentSharingan);
                    });
                });
                
                // Set up tracking button listeners
                trackingButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        trackingButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        const trackingType = this.getAttribute('data-type');
                        
                        if (trackingType === 'camera') {
                            enableCameraTracking();
                        } else {
                            enableMouseTracking();
                        }
                    });
                });
            }
            
            // Update Sharingan based on type
            function updateSharingan(type) {
                // Clear existing tomoe
                sharinganElements.forEach(eye => {
                    eye.innerHTML = '';
                });
                
                // Add new tomoe based on type
                if (type === 'one-tomoe') {
                    addTomoe(1);
                } else if (type === 'two-tomoe') {
                    addTomoe(2);
                } else if (type === 'three-tomoe') {
                    addTomoe(3);
                } else if (type === 'mangekyo') {
                    createMangekyo();
                }
            }
            
            // Add tomoe to Sharingan
            function addTomoe(count) {
                sharinganElements.forEach(eye => {
                    for (let i = 0; i < count; i++) {
                        const tomoe = document.createElement('div');
                        tomoe.classList.add('tomoe');
                        
                        // Position tomoe in a circle
                        const angle = (i * (360 / count) - 90) * (Math.PI / 180);
                        const radius = 35;
                        const x = 50 + radius * Math.cos(angle);
                        const y = 50 + radius * Math.sin(angle);
                        
                        tomoe.style.left = `${x}%`;
                        tomoe.style.top = `${y}%`;
                        tomoe.style.transform = 'translate(-50%, -50%)';
                        
                        eye.appendChild(tomoe);
                    }
                });
            }
            
            // Create Mangekyo pattern
            function createMangekyo() {
                sharinganElements.forEach(eye => {
                    // Create a more complex pattern for Mangekyo
                    for (let i = 0; i < 3; i++) {
                        const shape = document.createElement('div');
                        shape.classList.add('tomoe');
                        shape.style.width = '25px';
                        shape.style.height = '8px';
                        shape.style.borderRadius = '4px';
                        shape.style.backgroundColor = '#e94560';
                        
                        // Position shapes in a circle
                        const angle = (i * 120 - 90) * (Math.PI / 180);
                        const radius = 35;
                        const x = 50 + radius * Math.cos(angle);
                        const y = 50 + radius * Math.sin(angle);
                        
                        shape.style.left = `${x}%`;
                        shape.style.top = `${y}%`;
                        shape.style.transform = `translate(-50%, -50%) rotate(${i * 120}deg)`;
                        
                        eye.appendChild(shape);
                    }
                    
                    // Add center circle
                    const center = document.createElement('div');
                    center.classList.add('tomoe');
                    center.style.width = '20px';
                    center.style.height = '20px';
                    center.style.left = '50%';
                    center.style.top = '50%';
                    center.style.transform = 'translate(-50%, -50%)';
                    
                    eye.appendChild(center);
                });
            }
            
            // Enable camera tracking
            async function enableCameraTracking() {
                currentTracking = 'camera';
                statusElement.textContent = 'Initializing camera...';
                
                try {
                    // Check if browser supports mediaDevices
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        throw new Error('Camera API not supported in this browser');
                    }
                    
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            facingMode: 'user' 
                        } 
                    });
                    
                    webcamElement.srcObject = stream;
                    isCameraActive = true;
                    statusElement.textContent = 'Camera active. Move side to side to see the eyes follow you.';
                    
                    // Simulate pose detection for demonstration
                    simulatePoseDetection();
                    
                } catch (err) {
                    statusElement.textContent = 'Error accessing camera: ' + err.message;
                    console.error('Error accessing camera:', err);
                    
                    // Fall back to mouse tracking
                    enableMouseTracking();
                    trackingButtons.forEach(btn => {
                        if (btn.getAttribute('data-type') === 'mouse') {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }
            }
            
            // Enable mouse tracking
            function enableMouseTracking() {
                currentTracking = 'mouse';
                isCameraActive = false;
                
                // Stop any camera stream
                if (webcamElement.srcObject) {
                    webcamElement.srcObject.getTracks().forEach(track => track.stop());
                    webcamElement.srcObject = null;
                }
                
                statusElement.textContent = 'Mouse tracking active. Move your mouse horizontally to control the eyes.';
                
                // Set up mouse movement tracking
                document.addEventListener('mousemove', handleMouseMovement);
            }
            
            // Handle mouse movement for tracking
            function handleMouseMovement(e) {
                if (currentTracking === 'mouse') {
                    const xPercentage = (e.clientX / window.innerWidth) * 100;
                    updateEyePosition(xPercentage);
                }
            }
            
            // Simulate pose detection for demonstration
            function simulatePoseDetection() {
                if (currentTracking !== 'camera') return;
                
                let xPos = 50;
                let movingRight = true;
                
                const detectionInterval = setInterval(() => {
                    if (isCameraActive && currentTracking === 'camera') {
                        // Simulate movement
                        if (movingRight) {
                            xPos += Math.random() * 2;
                            if (xPos > 70) movingRight = false;
                        } else {
                            xPos -= Math.random() * 2;
                            if (xPos < 30) movingRight = true;
                        }
                        
                        // Update eye position based on simulated movement
                        updateEyePosition(xPos);
                    } else {
                        clearInterval(detectionInterval);
                    }
                }, 100);
            }
            
            // Update eye position based on detected movement
            function updateEyePosition(xPercentage) {
                // Calculate pupil movement (limited to stay within eye)
                const moveX = (xPercentage - 50) / 10;
                
                // Update pupils
                pupils.forEach(pupil => {
                    pupil.style.transform = `translate(calc(-50% + ${moveX}px), -50%)`;
                });
                
                // Update sharingan rotation slightly for dynamic effect
                sharinganElements.forEach(eye => {
                    eye.style.transform = `rotate(${moveX * 0.3}deg)`;
                });
            }
            
            // Initialize the application
            initSharingan();
        });
    </script>
</body>
</html>